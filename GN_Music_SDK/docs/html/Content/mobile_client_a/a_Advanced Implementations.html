<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="no-feedback" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Mobile Client Android Implementation Guide (3.1)">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Advanced Implementations</title>
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/BookStyles.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="a_Mobile Client Android Implementation.html#_Toc349118723">Mobile Client Android Implementation Guide (3.1)</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Advanced Implementations</span>
        </div>
        <h2><a name="_Toc349118789"></a>Advanced Implementations</h2>
        <h3><a name="_Toc349118790"></a>Service-Based Implementations</h3>
        <p>These examples show utilizing the Mobile Client libraries in an Android Service. Use of a Service is an advanced concept requiring significantly more design and development than an Activity-based application. For this reason, activity-based implementations are recommended. However, for those cases when the Mobile Client functionality must run without a UI, we support running the Mobile Client in an Android Service.</p>
        <p>Prerequisite: </p>
        <ul>
            <li value="1">The included Mobile Client Sample application must be installed, complied, and functioning on a device before developing Android Service-based implementations.</li>
        </ul>
        <p>To use the example code:</p>
        <ol>
            <li value="1">Copy and paste the code into your Eclipse project in different .java files.</li>
            <li value="2">Add a clientID string.</li>
            <li value="3">Register service with adding the following code in the AndroidManifest.xml file: &lt;service android:enabled="true" android:name="com.example.GracenoteService" /&gt;</li>
            <li value="4">Add any other required code.</li>
            <li value="5">Compile and run.</li>
        </ol>
        <h4>Service Control Application</h4>
        <p>The Service Control Application stops, starts, and provides the status of an Android Service.<br />This example code is not required to utilize Mobile Client functionality. It is recommended that you provide a friendly way for the end-user to know a background Service is running, to restart, and to stop. This functionality could be included in an application the Service interacts with.</p>
        <p class="note"><span class="note">Note:</span> Since this application launches the Service, the application needs to be running for the Service to continue.</p><pre xml:space="preserve">/* Gracenote Android Music SDK Sample Service Launcher<br /> *<br /> * Copyright (C) 2010, 2011 Gracenote, Inc. All Rights Reserved.<br /> */<br />package com.example;<br /><br />import com.example.GracenoteService;<br /><br />import android.app.Activity;<br />import android.content.Intent;<br />import android.graphics.Color;<br />import android.os.Bundle;<br />import android.util.Log;<br />import android.view.View;<br />import android.view.View.OnClickListener;<br />import android.widget.Button;<br />import android.widget.TextView;<br />/**<br /> *&#160;&#160;&#160; Example application that Stops, Starts, and provides the Status of an Android Service.<br /> *&#160;&#160;&#160; This example code is NOT REQUIRED as this functionality can/should be built into an<br /> *&#160;&#160;&#160; application the Service is supporting.&#160; It is recommended that you provide a friendly<br /> *&#160;&#160;&#160; way for the end-user to know a background Service is running, to restart, and to stop.<br /> */<br />public class ServicesDemo extends Activity implements OnClickListener {<br />&#160; private static final String TAG = "GracenoteServiceLauncher";<br />&#160; String startedStatusString = "Status: Started";<br />&#160; String stoppedStatusString = "Status: Stopped";<br />&#160; Button buttonStart, buttonStop;<br />&#160; TextView textViewStatus;<br />&#160; static boolean serviceStatus;<br /><br />&#160; @Override<br />&#160; public void onCreate(Bundle savedInstanceState) {<br />&#160;&#160;&#160; super.onCreate(savedInstanceState);<br />&#160;&#160;&#160; setContentView(R.layout.main);<br /><br />&#160;&#160;&#160; buttonStart = (Button) findViewById(R.id.buttonStart);<br />&#160;&#160;&#160; buttonStop = (Button) findViewById(R.id.buttonStop);<br /><br />&#160;&#160;&#160; textViewStatus = (TextView) findViewById(R.id.textStatus);<br />&#160;&#160;&#160; if(serviceStatus){<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; textViewStatus.setText(startedStatusString);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; textViewStatus.setTextColor(Color.GREEN);<br />&#160;&#160;&#160; }else {<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; textViewStatus.setText(stoppedStatusString);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; textViewStatus.setTextColor(Color.RED);<br />&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; buttonStart.setOnClickListener(this);<br />&#160;&#160;&#160; buttonStop.setOnClickListener(this);<br />&#160; }<br /><br />&#160; public void onClick(View src) {<br />&#160;&#160;&#160; switch (src.getId()) {<br />&#160;&#160;&#160; case R.id.buttonStart:<br />&#160;&#160;&#160;&#160;&#160; Log.d(TAG, "onClick: starting service");<br />&#160;&#160;&#160;&#160;&#160; startService(new Intent(this, GracenoteService.class));<br />&#160;&#160;&#160;&#160;&#160; textViewStatus.setText(startedStatusString);<br />&#160;&#160;&#160;&#160;&#160; textViewStatus.setTextColor(Color.GREEN);<br />&#160;&#160;&#160;&#160;&#160; serviceStatus = true;<br />&#160;&#160;&#160;&#160;&#160; break;<br />&#160;&#160;&#160; case R.id.buttonStop:<br />&#160;&#160;&#160;&#160;&#160; Log.d(TAG, "onClick: stopping service");<br />&#160;&#160;&#160;&#160;&#160; Boolean test = stopService(new Intent(this, GracenoteService.class));<br />&#160;&#160;&#160;&#160;&#160; if (test) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Log.d(TAG, "service stopped");<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; textViewStatus.setText(stoppedStatusString);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; textViewStatus.setTextColor(Color.RED);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; serviceStatus = false;<br />&#160;&#160;&#160; }else {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Log.d(TAG, "not able to stop service");<br />&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160; break;<br />&#160;&#160;&#160; }<br />&#160; }<br />}</pre>
        <h4>Service Implementation</h4>
        <p>This use case shows recognizing music files located in a directory with MusicID-File.<br />A Client ID string is required and must be compiled into a java Service class. For details, see <a href="a_Configuration and Authentication.html" class="GNBasic MCXref xref xrefGNBasic">Configuration and Authentication</a>.</p>
        <p>A Service implementation may save the results of a query (GNResult object) in a local database, file, or memory. This example shows saving the results to a file (response.log). For details on supported operations, see <a href="a_Operations.html" class="GNBasic MCXref xref xrefGNBasic">Operations</a>. Typical implementations are likely to loop, watching directories or receive messages from another application that invokes GNOperations. Event-based implementations and looping in the background as an Android Service requires careful design. </p>
        <p>The following example code can be copied into an Eclipse project that has the Mobile Client SDK properly installed. It is recommended that the included Mobile Client Sample application be installed, compiled, and functioning on a device before developing Android Service-based implementations.</p><pre xml:space="preserve">/* Gracenote Android Music SDK Sample Service<br /> *<br /> * Copyright (C) 2010, 2011 Gracenote, Inc. All Rights Reserved.<br /> */<br />package com.example;<br /><br />import java.io.File;<br />import android.app.Service;<br />import android.content.Intent;<br />import android.os.Binder;<br />import android.os.IBinder;<br />import android.util.Log;<br /><br />import com.gracenote.mmid.MobileSDK.*;<br />/**<br />*&#160;&#160;&#160;&#160; Android "Service" that implements Gracenote Mobile Client interfaces for recognizing music files (MID-File).<br />*&#160;&#160;&#160;&#160; A ClientID string is required and must be compiled into a java Service class.<br />*&#160;&#160;&#160;&#160; Code for interacting with a "bound" application likely desired for customer implementations. A Service<br />*&#160;&#160;&#160;&#160; implementation likely uses the result object (GNSearchResult) within this Service vs. logging it to a<br />*&#160;&#160;&#160;&#160; file as shown for recognizing music files.&#160; See "Implementation Guide" for details on supported operations.<br /> */<br />public class GracenoteService extends Service implements GNSearchResultReady, GNOperationStatusChanged {<br />&#160;&#160;&#160; private final Binder binder = new LocalBinder();<br />&#160;&#160;&#160; private GNConfig config;<br />&#160;&#160;&#160; // Default location for Gracenote file; change for customer specific location.<br />&#160;&#160;&#160; String debugLog = "/sdcard/gracenote/response.log";<br /><br />&#160;&#160;&#160; /**<br />&#160;&#160;&#160;&#160; * Class for clients to access. Because we know this service always runs in<br />&#160;&#160;&#160;&#160; * the same process as its clients, we don't need to deal with IPC.<br />&#160;&#160;&#160;&#160; */<br />&#160;&#160;&#160; public class LocalBinder extends Binder {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; GracenoteService getService() {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return (GracenoteService.this);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; /**<br />&#160;&#160;&#160;&#160; * Return the communication channel to the service.<br />&#160;&#160;&#160;&#160; */<br />&#160;&#160;&#160; @Override<br />&#160;&#160;&#160; public IBinder onBind(Intent intent) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return (binder);<br />&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; /**<br />&#160;&#160;&#160;&#160; * Called by the system when the service is first created.<br />* MUST BE IMPLEMENTED.<br />&#160;&#160;&#160;&#160; */<br />&#160;&#160;&#160; @Override<br />&#160;&#160;&#160; public void onCreate() {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; // client ID string is REQUIRED (Gracenote provided): format MUST Be: NNNNNNN-NNNNNNNNNNNNNNNNNN<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; config = GNConfig.init("",this.getApplicationContext());<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; File debugLogFile = new File(debugLog);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (debugLogFile.exists()) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; debugLogFile.delete();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; /**<br />&#160;&#160;&#160;&#160; * Called by the system to notify a Service that it is no longer used and is<br />&#160;&#160;&#160;&#160; * being removed.<br />&#160;&#160;&#160;&#160; */<br />&#160;&#160;&#160; @Override<br />&#160;&#160;&#160; public void onDestroy() {<br /><br />&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; /**<br />&#160;&#160;&#160;&#160; * Called by the system every time a client explicitly starts the service<br />&#160;&#160;&#160;&#160; */<br />&#160;&#160;&#160; @Override<br />&#160;&#160;&#160; public void onStart(Intent intent, int startid) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; recognizeFileMethod();<br />&#160;&#160;&#160; }<br />// Define supported file formats that MID-File can decode into PCM.<br />&#160;&#160;&#160; private boolean isSupportedFormat(String filename) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; return (filename.endsWith(".wav") || filename.endsWith(".mp3")<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; || filename.endsWith(".mp4") || filename.endsWith(".m4a") || filename<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .endsWith(".3gp"));<br />&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; /**<br />&#160;&#160;&#160;&#160; * Fingerprint files stored as files in /sdcard/gracenote/. For each file,<br />&#160;&#160;&#160;&#160; * create a fingerprint and search for song metadata.<br />&#160;&#160;&#160;&#160; */<br />&#160;&#160;&#160; private void recognizeFileMethod() {<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; File sdcard = new File("/sdcard/gracenote");<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (sdcard.exists()) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String[] filenames = sdcard.list();<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; for (String filename : filenames) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (isSupportedFormat(filename)) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; File file = new File(sdcard, filename);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String filePath = file.getAbsolutePath();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GNOperations.recognizeMIDFileFromFile(this, this.config,filePath);<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // numFilesToFingerprint++;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String resultMsg = "No supported music files were found on the sdCard.&#160; Please install files in the /sdcard/gracenote/ directory of your device or emulator.";<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("Err: " + resultMsg);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("\n");<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; /**<br />&#160;&#160;&#160;&#160; * When the fingeprint/lookup operation is finished, this method will be<br />&#160;&#160;&#160;&#160; * invoked to record results in a file. ACTUAL IMPLEMENTATION IS CUSTOMER SPECIFIC and not likely to be<br />&#160;&#160;&#160;&#160; * a file.<br />&#160;&#160;&#160;&#160; */<br />&#160;&#160;&#160; public void GNResultReady(GNSearchResult result) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (result.isFailure()) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // An error occurred so display the error to the user.<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String msg = String.format("[%d] %s", result.getErrCode(), result<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .getErrMessage());<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("Err: " + msg);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("\n");<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (result.isFingerprintSearchNoMatchStatus()) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Handle case of lookup with no match<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("No Match: ");<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("\n");<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; } else {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; GNSearchResponse bestResponse = result.getBestResponse();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("Album title: " + bestResponse.getAlbumTitle());<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("Artist name: " + bestResponse.getArtist());<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("Track title: " + bestResponse.getTrackTitle());<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("Track Genre: " + bestResponse.getGenre());<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; writeToLog("\n");<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; /**<br />&#160;&#160;&#160;&#160; * Intermediate status update from the fingerprinter. Could be used to status the bound application.<br />&#160;&#160;&#160;&#160; */<br />&#160;&#160;&#160; public void GNStatusChanged(GNStatus status) {<br /><br />&#160;&#160;&#160; }<br /><br />&#160;&#160;&#160; /**<br />&#160;&#160;&#160;&#160; * Writes results of a query to log. Customer implementations expected to differ.<br />&#160;&#160;&#160;&#160; */<br />&#160;&#160;&#160; private void writeToLog(String msg) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; File debugLogFile = new File(debugLog);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Commented out so result output log file is not deleted---for testing only.<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; // if (debugLogFile.exists()) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; // debugLogFile.delete();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; // }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; try {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; File parentDir = debugLogFile.getParentFile();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (!parentDir.exists()) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; parentDir.mkdir();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (msg.charAt(msg.length() - 1) != '\n') {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; StringBuilder builder = new StringBuilder(msg.length() + 1);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; builder.append(msg);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; builder.append('\n');<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; msg = builder.toString();<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (parentDir.exists()) {<br /><br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // If parent dir does not exist after mkdir(), likely<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // that /sdcard does not exist.<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; boolean worked = GNUtil.appendUTF8(debugLog, msg);<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (!worked)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Log.d("SAMPLE_APP", "Can't write to log file.");<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; } catch (Exception e) {<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Log.d("SAMPLE_APP", "Can't write to log file.");<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }<br />&#160;&#160;&#160; }<br />}</pre>
        <h4>Considerations</h4>
        <h5>Interacting with an Application</h5>
        <p>Most use cases are best addressed by creating a Service that interacts with only one application. Doing this eliminates complexity with interprocess communication. If interacting with multiple applications, Service code will be required to ensure the responses from the Mobile Client are delivered to the appropriate application. Using the Mobile Client with multiple applications may require each application to be validated by Gracenote.</p>
        <h5>Interruptions</h5>
        <p>When running an Android Service in the background, the Service must handle situations like a phone call interrupting a Mobile Client operation. Although many of these events are automatically handled when using an "activity" based application, background Service implementations must handle these events.</p>
        <h5>Background Operation</h5>
        <p>If the Service continually runs in the background, code is required to handle receiving events, looping, and restarting. For example, if a Service is designed to monitor directories for new music placed on the device, code is required to check the directories on some interval, compare the new files with a cache/database of prior recognitions, call the appropriate Mobile Client Operation, save the results, and then start the cycle again.</p>
        <h5>Installation and Starting</h5>
        <p>For a Service to be installed and started on a device, you must develop a method that includes the Service as a part of an application (.apk) or registered as a Service or some other method. The simplest approach that works on all versions of Android is to have an installed widget-based application that registers the Service as well as checks its status. The alternative is to have a primary application include the code to start the Service.</p>
        <h5>Error Handling</h5>
        <p>Handling errors with a background Service that has no UI requires careful design. A simple approach is to pass status messages to the calling application. </p>
        <h3><a name="_Toc349118791"></a>User History</h3>
        <p>The Mobile Client Sample Application includes a user history feature. It stores the results of certain operations and allows the user to view them. When viewed, the history record displays the recognized music, including Cover Art and the location of the user when the operation occurred.</p>
        <p>The feature uses a local SQLite database to store the user history information.</p>
        <h4>Data Model</h4>
        <p>A simple data model is used to store the data as shown below.</p>
        <p>
            <img src="../Resources/Images/Mobile Client Documentation (3.1)1/03000012_209x263.png" style="width: 209;height: 263;" />
        </p>
        <p>Mobile Client Sample Application User History Database Data Model</p>
        <p>The Mobile Client Sample Application uses a helper class, called DataBaseAdapter, to handle the history database. It creates a simplified interface for managing the database and adding, deleting, and retrieving data from the database.</p>
        <p>Internally, DataBaseAdapter uses Android classes that simplify interacting with a SQLite database. The SQLiteDatabase class provides methods for creating a database, deleting a database, and issuing SQL queries. SQLiteDatabase can be used with another helper class, SQLiteOpenHelp, which uses a transaction-based method to interact with the underlying SQL database to ensure it is always in a usable state.</p>
        <p>Internally, DataBaseAdapter uses DatabaseHelper, which extends SQLiteOpenHelp and implements the onCreate, onOpen, and onUpgrade methods. When a database is created, onCreate and DatabaseHelper use SQL queries to create the database tables. The SQL queries are used to implement the user history data model.</p>
        <h4>Adding Entries</h4>
        <p>When results for an appropriate operation are received, an entry is added to the database. Only results from the following operations are stored:</p>
        <ul>
            <li value="1">Recognizing music from the microphone</li>
            <li value="2">Recognizing music from a PCM sample</li>
        </ul>
        <p>The process of adding an entry to the database is initiated from the GNResultReady method of the appropriate GNSearchResultReady objects. The process retrieves the current GPS location information from the device and submits the results to the database using the DataBaseAdapter.insertChanges method.</p>
        <h4>Limiting Database Size</h4>
        <p>The size of the database cannot be allowed to grow indefinitely. After adding an entry to the database, its size is checked to determine if it exceeds a predefined limit of 1000 entries. If there are more than 1000 entries, the oldest entries in the database are deleted, bringing the size back to the predetermined limit.</p>
        <h4>Recalling Entries</h4>
        <p>The Mobile Client Sample Application uses an SQL query to retrieve all the rows in the database. These are returned as a Cursor object that allows each value in each row returned to be extracted using getter methods. The sample application extracts the rows into Locations objects that are used to populate a UI that allows the user to navigate the entries. For large databases, a paging mechanism can be used to reduce the number of rows exported into memory at any one time.</p>
        <h3><a name="_Toc349118792"></a>UI Best Practices Using MusicID-Stream</h3>
        <p>Gracenote periodically conducts analysis on its MusicID-Stream product to evaluate its usage and determine if there are ways we can make it even better. Part of this analysis is determining why some MusicID-Stream recognition queries do not find a match.</p>
        <p>Consistently Gracenote finds that the majority of failing queries contain an audio sample of silence, talking, humming, singing, whistling or live music. These queries fail because the Gracenote MusicID-Stream service can only match commercially released music.</p>
        <p>Such queries are shown to usually originate from applications that do not provide good end user instructions on how to correctly use the MusicID-Stream service. Therefore Gracenote recommends application developers consider incorporating end user instructions into their applications from the beginning of the design phase. This section describes the Gracenote recommendations for instructing end users on how to use the MusicID-Stream service in order to maximize recognition rates and have a more satisfied user base.</p>
        <p>This section is specifically targeted to applications running on a user's cellular handset, tablet computer, or similar portable device, although end user instructions should be considered for all applications using MusicID-Stream. Not all recommendations listed here are feasible for every application. Consider them options for improving your application and the experience of your end users.</p>
        <h4>Clear and Accessible</h4>
        <p>All instructions provided to the user should be easy to understand and accessible at any time. For example:</p>
        <ul>
            <li value="1">Use pictures instead of text</li>
            <li value="2">Provide a section in the device user manual (where applicable)</li>
            <li value="3">Provide a help section within the application</li>
            <li value="4">Include interactive instructions embedded within the flow of the application. For example, prompt the user to hold the device to the audio source.</li>
        </ul>
        <h4>Rotating Help Message upon Failed Recognition</h4>
        <p>When a recognition attempt fails, display a help message with a hint or tip on how to best use the MusicID-Stream service; a concise, useful tip can persuade a user to try again. Have a selection of help messages available; show one per failed recognition attempt, but rotate which message is displayed.</p>
        <h4>Allow the User to Provide Feedback</h4>
        <p>When a recognition attempt fails, allow the user to submit a hint with information about what they are looking for. Based on the response, the application could return a targeted help message about the correct use of MusicID-Stream.</p>
        <h4>Audio Listening Animation</h4>
        <p>While the device is recording an audio sample, display a simple image or animation that explains how to correctly use MusicID-Stream.</p>
        <h4>Audio Listening Progress Indicator or Countdown</h4>
        <p>Use a progress bar or countdown to indicate how long the application will be recording. The user can use this information to assist in collecting an audio sample that can be successfully recognized.</p>
        <h4>Audio Listening Completed Cues</h4>
        <p>Some failing MusicID-Stream recognitions are caused by insufficient or incomplete recording of the song. To assist the user in assessing if recording is complete, visual, audible and tangible cues can be used, such as:</p>
        <ul>
            <li value="1">Display a message (only useful if the user is looking at the display)</li>
            <li value="2">Sound a tone or tune (not useful in load environments)</li>
            <li value="3">Vibrate the handset (always useful)</li>
        </ul>
        <h4>Use Street Sign-like Images</h4>
        <p>Street sign images are universal and easily recognizable. These can be used to provide clear instructions about where and how to use and not to use the MusicID-Stream service.</p>
        <h4>Demo Animation</h4>
        <p>Provide a small, simple animation that communicates how to use the application. Make this animation accessible at all times from the Help section.</p>
        <p class="onlineFooter">© 2000 to present. Gracenote, Inc. All rights reserved.</p>
        <p><a href="mailto:doc_feedback@gracenote.com?subject=Gracenote Documentation Feedback" target="_blank" title="Send comments about this topic to Gracenote Technical Publications." alt="Send comments about this topic to Gracenote Technical Publications.">How can we improve this documentation?</a>
        </p>
    </body>
</html>